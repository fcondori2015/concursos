<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:body>
        <ui:composition template="/WEB-INF/facelets/template.xhtml">
            <ui:define name="content">
                <p:layout style="min-height:200px; height: 32.7em;" stateful="enabled" >

                    <p:layoutUnit position="center" resizable="true">
                        <h:form> 
                            <p:dataScroller value="#{beanResolucion.listaResoluciones}" var="resolucion" chunkSize="5" mode="inline" scrollHeight="383" >
                                <f:facet name="header">
                                    Expedientes Registrados
                                </f:facet>

                                <h:panelGrid columns="1" style="width:100%" >
                                    <p:outputPanel>
                                        <h:panelGrid columns="6" cellpadding="5">
                                            <f:facet name="header" >
                                                Expediente 
                                                <h:outputText value="Id: #{resolucion.expediente.idExpediente} - Num: #{resolucion.expediente.numeroExpediente} - UDO: #{resolucion.expediente.unidadDeOrganizacion.nombreUnidad}" style="font-weight: bold"/>
                                            </f:facet>
                                            <h:outputText value="Id Resolucion:" />
                                            <h:outputText value="#{resolucion.idResolucion}" style="font-weight: bold"/>

                                            <h:outputText value="Numero de Resolucion:" />
                                            <h:outputText value="#{resolucion.numeroResolucion}" style="font-weight: bold"/>

                                            <h:outputText value="Agrupamiento:" />
                                            <h:outputText value="#{resolucion.agrupamiento}" style="font-weight: bold"/>
                                            
                                        </h:panelGrid>
                                        <p:separator />
                                    </p:outputPanel>
                                </h:panelGrid>
                            </p:dataScroller>
                        </h:form>
                    </p:layoutUnit>
                    <p:layoutUnit position="east" resizable="true"  size="700" minSize="600"  header="Formulario de Registro de Concursos" maxSize="800" collapsible="true" >

                        <p:tabView activeIndex="#{beanConcurso.numeroDePestania}" effect="fade" effectDuration="fast" id="tabuladorPestañero" >
                            <p:effect type="bounce" event="onchange" />
                            <p:ajax event="tabChange"  listener="#{beanConcurso.validarPestania}" update="tabuladorPestañero:formExpedientes:msg"/>

                            <!--   
                            **********************************
                            PESTAÑA EXPEDIENTES
                            **********************************
                            -->
                            <p:tab title="Expediente" id="tabExpediente" >
                                <h:form id="formExpedientes">
                                    <p:growl id="msg" showDetail="true" escape="false" sticky="false" life="5000"  />
                                    <h:panelGrid columns="3" cellpadding="3" frame="box" styleClass="panelAlta" >
                                        <f:facet name="header" class="encabezadoPanel">
                                            <h:outputText value="Datos Generales del Expediente" />
                                        </f:facet>

                                        <p:selectOneMenu id="cmbUnidadExpediente" value="#{beanExpediente.expedienteNuevo.unidadDeOrganizacion.codigoUnidadDeOrganizacion}" required="true" requiredMessage="Seleccione un Àrea" filter="true" validatorMessage="Seleccione un área válida" >
                                            <f:selectItem noSelectionOption="true" itemLabel=" Seleccione un Área" itemValue="null" />
                                            <f:selectItems var="unidad" value="#{beanExpediente.listaUnidadDeOrganizacions}" itemLabel="#{unidad.nombreUnidad} (#{unidad.codigoUnidadDeOrganizacion})" itemValue="#{unidad.codigoUnidadDeOrganizacion}" />
                                        </p:selectOneMenu>

                                        <p:spinner id="spnNumeroExpediente" value="#{beanExpediente.expedienteNuevo.numero}" placeholder="Número" min="0" max="9999" required="true" requiredMessage="Ingrese el Número que figura en el expediente" validatorMessage="Ingrese un numero de expediente válido"  />

                                        <p:spinner id="spnAnio" value="#{beanExpediente.expedienteNuevo.anio}" placeholder="Año" min="1950" max="2015" required="true" requiredMessage="Ingrese el año que figura en el expediente" validatorMessage="Ingrese un año válido" size="5" />

                                        <p:column>
                                            <h:outputText value="Régimen que aplica" />
                                            <p:selectOneMenu id="cmbRegimenExpediente" value="#{beanExpediente.expedienteNuevo.regimen}" style="width:100%;">
                                                <f:selectItem itemLabel="Profesional" itemValue="PROFESIONAL"/>
                                                <f:selectItem itemLabel="Técnico" itemValue="TECNICO"/>
                                                <f:selectItem itemLabel="General" itemValue="GENERAL"/>
                                            </p:selectOneMenu>
                                        </p:column>

                                        <p:column>
                                            <h:outputText value="Situación" />
                                            <p:selectOneMenu id="cmbSituacionExpediente" value="#{beanExpediente.expedienteNuevo.situacion}" style="width:100%;">
                                                <f:selectItem itemLabel="En ejecucion" itemValue="EN EJECUCION"/>
                                                <f:selectItem itemLabel="Cancelado" itemValue="CANCELADO"/>
                                                <f:selectItem itemLabel="Finalizado" itemValue="FINALIZADO"/>
                                            </p:selectOneMenu>
                                        </p:column>


                                    </h:panelGrid>
                                    <p:commandButton id="btnGuardarNuevoExpediente" value="Guardar" actionListener="#{beanExpediente.guardarExpediente}" icon="ui-icon-disk" update="tabuladorPestañero,tabuladorPestañero:formExpedientes:msg,tabuladorPestañero:formResoluciones:tblResoluciones,lblEncabezadoNuevaResolucion" styleClass="btnVerde" />
                                </h:form>
                            </p:tab>


                            <!--   
                            **********************************
                            PESTAÑA RESOLUCIONES  
                            **********************************
                            -->
                            <p:tab title="Resoluciones"  id="tabResoluciones" disabled="#{!beanExpediente.datosValidos}" >
                                <h:form id="formResoluciones">
                                    <p:commandButton value="Nuevo" onclick="PF('dlgNuevaResolucion').show();" icon="ui-icon-plusthick" />
                                    <p:dataTable  id="tblResoluciones" var="resolucion" value="#{beanResolucion.listaResoluciones}" rows="1"
                                                  paginator="true"
                                                  paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                  rowsPerPageTemplate="1,3,5,10,15"
                                                  reflow="true" 
                                                  emptyMessage="Sin cargos Registrados"
                                                  draggableColumns="true"

                                                  style="text-align: center; margin-top: 5px;">
                                        <f:facet name="header">
                                            <h:outputText id="lblNumeroDeExpedienteEnResolucion" value="Resoluciones en el expediente #{beanExpediente.expedienteNuevo.numeroExpediente}" />
                                            <p:commandButton id="togglerResoluciones" type="button" value="Columnas" style="float:right" icon="ui-icon-calculator" />
                                            <p:columnToggler datasource="tblResoluciones" trigger="togglerResoluciones" />
                                        </f:facet>
                                        <p:column headerText="Id">
                                            <h:outputText value="#{resolucion.idResolucion}" />
                                        </p:column>
                                        <p:column headerText="Número">
                                            <h:outputText value="#{resolucion.numeroResolucion}" />
                                        </p:column>
                                        <p:column headerText="Agrupamiento">
                                            <h:outputText value="#{resolucion.agrupamiento}" />
                                        </p:column>
                                        <p:column headerText="Expediente">
                                            <h:outputText value="#{resolucion.expediente.numeroExpediente}" />
                                        </p:column>
                                        <p:column headerText="Oposición">
                                            <h:outputText value="#{resolucion.oposicion}" />
                                        </p:column>
                                        <p:column headerText="Modificatoria">
                                            <h:outputText value="#{resolucion.modificacion}" />
                                        </p:column>
                                        <p:column headerText="Clase">
                                            <h:outputText value="#{resolucion.clase}" />
                                        </p:column>
                                        <p:column headerText="Apertura">
                                            <h:outputText value="#{resolucion.fechaApertura}" >
                                                <f:convertDateTime pattern="dd/MM/yyyy" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Cierre">
                                            <h:outputText value="#{resolucion.fechaCierre}" >
                                                <f:convertDateTime pattern="dd/MM/yyyy" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Ejecución">
                                            <h:outputText value="#{resolucion.fechaEjecucion}" >
                                                <f:convertDateTime pattern="dd/MM/yyyy" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Publicación">
                                            <h:outputText value="#{resolucion.fechaPublicacion}" >
                                                <f:convertDateTime pattern="dd/MM/yyyy" />
                                            </h:outputText>
                                        </p:column>
                                        <p:column headerText="Estado">
                                            <h:outputText value="#{resolucion.estado}" />
                                        </p:column>

                                    </p:dataTable>
                                </h:form>
                            </p:tab>


                            <!--   
                            **********************************
                            PESTAÑA CARGOS
                            **********************************
                            -->
                            <p:tab title="Cargos" id="tabCargos" disabled="#{!beanResolucion.datosValidos}" >

                                <h:form id="formCargos">

                                    <h:panelGrid columns="2" >
                                        <p:commandButton value="NuevoCargo" icon="ui-icon-plusthick" onclick="PF('dlgCargoNuevo').show();" />
                                        <p:commandButton value="Actualizar" icon="ui-icon-refresh" />
                                    </h:panelGrid>


                                    <p:dataTable id="tblCargos" var="cargos" value="#{beanCargo.listaCargos}" rows="3"
                                                 paginator="true"
                                                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                 rowsPerPageTemplate="3,5,10,15" reflow="true" >

                                        <f:facet name="header">
                                            <h:outputText id="lblNumeroResolucionCargo" value="Expediente: #{beanCargo.cargoNuevo.resolucion.expediente.numeroExpediente} - Resolución: #{beanCargo.cargoNuevo.resolucion.numeroResolucion}" />
                                        </f:facet>
                                        <p:column headerText="Id">
                                            <h:outputText value="#{cargos.idCargo}" />
                                        </p:column>
                                        <p:column headerText="Profesion">
                                            <h:outputText value="#{cargos.profesion.nombreProfesion}" />
                                        </p:column>
                                        <p:column headerText="Especialidad">
                                            <h:outputText value="#{cargos.especialidad}" />
                                        </p:column>
                                        <p:column headerText="Categoria">
                                            <h:outputText value="#{cargos.categoria}" />
                                        </p:column>
                                        <p:column headerText="Función">
                                            <h:outputText value="#{cargos.funcion}" />
                                        </p:column>
                                        <p:column headerText="Establecimiento">
                                            <h:outputText value="#{cargos.establecimiento.nombre}" />
                                        </p:column>
                                        <p:column headerText="Resolución">
                                            <h:outputText value="#{cargos.resolucion.numeroResolucion}" />
                                        </p:column>
                                        <p:column headerText="Cantidad">
                                            <h:outputText value="#{cargos.cantidad}" />
                                        </p:column>
                                    </p:dataTable>
                                </h:form>


                            </p:tab>


                            <!--   
                            **********************************
                            PESTAÑA TRIBUNAL 
                            **********************************
                            -->
                            <p:tab title="Tribunal" id="tabTribunal" disabled="#{!beanCargo.datosValidos}" >


                            </p:tab>


                            <!--   
                            **********************************
                            PESTAÑA POSTULANTES 
                            **********************************
                            -->
                            <p:tab title="Postulantes" id="tabPostulantes" disabled="#{!beanTribunal.datosValidos}" >
                                <h:panelGrid columns="2" cellpadding="3" frame="box" styleClass="panelAlta" >

                                </h:panelGrid>
                            </p:tab>


                            <!--   
                            **********************************
                            PESTAÑA RESULTADO
                            **********************************
                            -->
                            <p:tab title="Resultado" id="tabResultado" disabled="true" >
                                <h:panelGrid columns="2" cellpadding="3" frame="box" styleClass="panelAlta" >

                                </h:panelGrid>
                            </p:tab>


                        </p:tabView>

                    </p:layoutUnit>
                </p:layout>


                <!--   
                **********************************
                DIALOGO PARA UNA NUEVA RESOLUCION  
                **********************************
                -->
                <p:dialog id="dlgNuevaResolucion" appendTo="@(body)" widgetVar="dlgNuevaResolucion" modal="true" showEffect="blind" hideEffect="blind" resizable="true" closable="true" closeOnEscape="true" >
                    <f:facet name="header">
                        <h:outputText id="lblEncabezadoNuevaResolucion" value="Resolucion Nueva - Exp. #{beanExpediente.expedienteNuevo.numeroExpediente}" />
                    </f:facet>
                    <h:form id="formNuevaResolucion">
                        <h:panelGrid columns="4" cellpadding="3" frame="box" styleClass="panelAlta" >
                            
                            <h:outputText value="Numero de Resolución" />
                            <p:spinner id="spnNumeroResolucion" value="#{beanResolucion.resolucionNueva.numeroResolucion}" placeholder="Número de Resolución" min="0" max="99999" required="true" requiredMessage="Ingrese el numero que figura en la resolucion"  maxlength="6" />

                            <p:selectOneMenu id="cmbDependenciaNumeroResolucion" value="#{beanResolucion.dependenciaNumeroResolucion}" required="true" requiredMessage="Seleccione una dependencia" >
                                <f:selectItem itemLabel="S" itemValue="S" />
                                <f:selectItem itemLabel="SPPRS" itemValue="SPPRS" />
                            </p:selectOneMenu>

                            <p:spinner id="spnAnioNumeroResolucion" value="#{beanResolucion.anioNumeroResolucion}" placeholder="Año" min="1950" max="2020" required="true" requiredMessage="Ingrese el año que figura en la resolucion"  maxlength="4" />

                            <h:outputText value="Estado" />
                            <p:selectOneMenu id="cmbEstadoResolucion" value="#{beanResolucion.resolucionNueva.estado}" style="width:100%;" >
                                <f:selectItem itemLabel="En ejecucion" itemValue="EN EJECUCION"/>
                                <f:selectItem itemLabel="Finalizado" itemValue="FINALIZADO"/>
                            </p:selectOneMenu>

                            <h:outputText value="Agrupamiento: " />
                            <p:selectOneMenu id="cmbAgrupamientoCargo" value="#{beanResolucion.resolucionNueva.agrupamiento}" style="width:100%;" filter="true" >
                                <f:selectItem itemLabel="Administrativo" itemValue="ADMINISTRATIVO"/>
                                <f:selectItem itemLabel="Profesional" itemValue="PROFESIONAL"/>
                                <f:selectItem itemLabel="Técnico" itemValue="TECNICO"/>
                                <f:selectItem itemLabel="Mantenimiento y Producción" itemValue="MANTENIMIENTO Y PRODUCCION"/>
                                <f:selectItem itemLabel="Servicios Generales" itemValue="SERVICIOS GENERALES"/>
                                <f:selectItem itemLabel="Profesional Asistencial" itemValue="PROFESIONAL ASISTENCIAL"/>
                            </p:selectOneMenu>
                            <h:panelGrid columns="2">
                                <h:outputText value="Modificacion Parcial: " />
                                <p:inputSwitch offLabel="No" onLabel="Si" value="#{beanResolucion.banderaModificacionParcial}" onchange="#{beanResolucion.cambiarEstadoModificacion()}" >
                                    <p:ajax listener="#{beanResolucion.cambiarEstadoModificacion()}" update="txtResolucionModificacion" />
                                </p:inputSwitch>
                            </h:panelGrid>
                            <p:inputText id="txtResolucionModificacion"  placeholder="numero de resolucion" disabled="#{beanResolucion.banderaModificacionParcial}" value="#{beanResolucion.resolucionNueva.modificaResolucion}"/>

                            <h:panelGrid columns="2" >
                                <h:outputText value="Prórroga: " />
                                <p:inputSwitch onchange="#{beanResolucion.cambiarEstadoProrroga()}" offLabel="No" onLabel="Si" value="#{beanResolucion.banderaProrroga}">
                                    <p:ajax listener="#{beanResolucion.cambiarEstadoProrroga()}" update="txtResolucionProrroga" />
                                </p:inputSwitch>
                            </h:panelGrid>
                            <p:inputText id="txtResolucionProrroga" placeholder="numero de resolucion" disabled="#{beanResolucion.banderaProrroga}" value="#{beanResolucion.resolucionNueva.prorrogaResolucion}" />


                            <h:outputText value="Antecedente" />
                            <p:selectBooleanCheckbox value="#{beanResolucion.resolucionNueva.antecedente}" />


                            <h:outputText value="Oposición" />
                            <p:selectBooleanCheckbox value="#{beanResolucion.resolucionNueva.oposicion}" />

                            <h:outputText value="Clase" />
                            <p:selectOneMenu id="cmbClaseResolucion" style="width:100%;" value="#{beanResolucion.resolucionNueva.clase}" >
                                <f:selectItem itemLabel="Ordinario" itemValue="ORDINARIO"/>
                                <f:selectItem itemLabel="Extraordinario" itemValue="EXTRAORDINARIO"/>
                            </p:selectOneMenu>

                            <p:column /><p:column />

                            <h:outputText value="Apertura: " />
                            <p:calendar id="calFechaApertura" value="#{beanResolucion.resolucionNueva.fechaApertura}" pattern="dd-MM-yyyy" mask="true" >
                                <p:ajax event="dateSelect" listener="#{beanResolucion.onDateSelect}" update="calFechaCierre,calFechaEjecucion" />
                            </p:calendar>

                            <h:outputText value="Ejecución: " />
                            <p:calendar id="calFechaEjecucion" value="#{beanResolucion.resolucionNueva.fechaEjecucion}" mindate="#{beanResolucion.resolucionNueva.fechaApertura}" pattern="dd-MM-yyyy" mask="true" />

                            <h:outputText value="Cierrre de inscripciones: " />
                            <p:calendar id="calFechaCierre" value="#{beanResolucion.resolucionNueva.fechaCierre}" mindate="#{beanResolucion.resolucionNueva.fechaApertura}" pattern="dd-MM-yyyy" mask="true" >
                                <p:ajax event="dateSelect" listener="#{beanResolucion.onDateSelect}" update="calFechaPublicacion" />
                            </p:calendar>

                            <h:outputText value="Publicación de Resultados" />
                            <p:calendar id="calFechaPublicacion" value="#{beanResolucion.resolucionNueva.fechaPublicacion}" mindate="#{beanResolucion.resolucionNueva.fechaCierre}" pattern="dd-MM-yyyy" mask="true" />

                        </h:panelGrid>
                        <p:commandButton id="btnGuardarNuevaResolucion" icon="ui-icon-disk" value="Guardar" actionListener="#{beanResolucion.guardarResolucion()}" oncomplete="PF('dlgNuevaResolucion').hide();" update="tabuladorPestañero,tabuladorPestañero:formResoluciones:tblResoluciones,tabuladorPestañero:formExpedientes:msg,tabuladorPestañero:formCargos:tblCargos" styleClass="btnVerde"  >
                            <f:setPropertyActionListener value="#{beanResolucion.resolucionNueva}" target="#{beanCargo.cargoNuevo.resolucion}" />
                        </p:commandButton>
                    </h:form>
                </p:dialog>

            </ui:define>
        </ui:composition>
    </h:body>
</html>

